<!-- TOC -->

- [分区与用户手工分表](#分区与用户手工分表)
- [不建议使用分区的原因](#不建议使用分区的原因)
- [分区的使用场景](#分区的使用场景)

<!-- /TOC -->

### 分区与用户手工分表

分区表和手工分表，一个是由 server 层来决定使用哪个分区，一个是由应用层代码来决定使用哪个分表。因此，从引擎层看，这两种方式也是没有差别的


### 不建议使用分区的原因

- MySQL 在第一次打开分区表的时候，需要访问所有的分区；
- 在 server 层，认为这是同一张表，因此所有分区共用同一个 MDL 锁；
- 在引擎层，认为这是不同的表，因此 MDL 锁之后的执行过程，会根据分区表规则，只访问必要的分区。


实际使用时，分区表跟用户分表比起来，有两个绕不开的问题：
- 一个是第一次访问的时候需要访问所有分区
- 另一个是共用 MDL 锁

因此，如果要使用分区表，就不要创建太多的分区。我见过一个用户做了按天分区策略，然后预先创建了 10 年的分区。这种情况下，访问分区表的性能自然是不好的。

这里有两个问题需要注意：

- 分区并不是越细越好。实际上，单表或者单分区的数据一千万行，只要没有特别大的索引，对于现在的硬件能力来说都已经是小表了。
- 分区也不要提前预留太多，在使用之前预先创建即可。比如，如果是按月分区，每年年底时再把下一年度的 12 个新分区创建上即可。对于没有数据的历史分区，要及时的 drop 掉。

### 分区的使用场景

分区表的一个显而易见的优势是对业务透明，相对于用户分表来说，使用分区表的业务代码更简洁。还有，分区表可以很方便的清理历史数据。

原文：
https://time.geekbang.org/column/article/82560