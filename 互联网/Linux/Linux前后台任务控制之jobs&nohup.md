##Linux前后台任务控制之jobs&nohup


- [Linux前后台任务控制之jobs&nohup](#linux前后台任务控制之jobsnohup)
    - [Shell前后台控制命令概览](#shell前后台控制命令概览)
    - [命令介绍](#命令介绍)
    - [概念：当前任务](#概念当前任务)
    - [查看jobs](#查看jobs)
    - [进程的挂起](#进程的挂起)
    - [进程的终止](#进程的终止)
    - [nohup命令参考](#nohup命令参考)



### Shell前后台控制命令概览

	1、command& 让进程在后台运行； 
	2、jobs 查看后台运行的进程；
	3、fg %n 让后台运行的进程n到前台来；
	4、bg %n 让进程n到后台去；
	PS:"n"为jobs查看到的进程编号.

### 命令介绍

fg、bg、jobs、&、ctrl + z都是跟系统任务有关的。

1、& 
    最经常被用到,这个用在一个命令的最后，可以把这个命令放到后台执行

2、ctrl + z
    可以将一个正在前台执行的命令放到后台，并且暂停

3、jobs
    查看当前有多少在后台运行的命令

4、fg
    将后台中的命令调至前台继续运行
    如果后台中有多个命令，可以用 fg %jobnumber将选中的命令调出，%jobnumber是通过jobs命令查到的后台正在执行的命令的序号(不是pid)

5、bg
    将一个在后台暂停的命令，变成继续执行
    如果后台中有多个命令，可以用bg %jobnumber将选中的命令调出，%jobnumber是通过jobs命令查到的后台正在执行的命令的序号(不是pid)

### 概念：当前任务 

如果后台的任务号有2个，[1],[2]；如果当第一个后台任务顺利执行完毕，第二个后台任务还在执行中时，当前任务便会自动变成后台任务号码“[2]”的后台任务。所以可以得出一点，即当前任务是会变动的。当用户输入“fg”、“bg”和“stop”等命令时，如果不加任何引号，则所变动的均是当前任务。

### 查看jobs 

使用jobs或ps命令可以察看正在执行的jobs。 
jobs命令执行的结果，＋加号表示是一个当前的作业，-减号表是是一个当前作业之后的一个作业，jobs -l选项可显示所有任务的PID,jobs的状态可以是running, stopped, Terminated,但是如果任务被终止了（kill），shell 从当前的shell环境已知的列表中删除任务的进程标识；也就是说，jobs命令显示的是当前shell环境中所起的后台正在运行或者被挂起的任务信息；

### 进程的挂起 

1、后台进程的挂起

在solaris中通过stop命令执行，通过jobs命令查看job号(假设为num)，然后执行stop %num；
在redhat中，不存在stop命令，可通过执行命令kill -stop PID，将进程挂起；
当要重新执行当前被挂起的任务时，通过bg %num 即可将挂起的job的状态由stopped改为running，仍在后台执行；当需要改为在前台执行时，执行命令fg %num即可；

2、前台进程的挂起

ctrl+Z;

### 进程的终止 

1、后台进程的终止

方法一：

通过jobs命令查看job号（假设为num），然后执行kill %num

方法二：

通过ps命令查看job的进程号（PID，假设为pid），然后执行

kill pid 

2、前台进程的终止

ctrl+c


### nohup命令参考

用途：不挂断地运行命令。

语法：```nohup Command [ Arg ... ] [　& ]```

描述：nohup 命令运行由 Command 参数和任何相关的 Arg 参数指定的命令，忽略所有挂断（SIGHUP）信号。在注销后使用 nohup 命令运行后台中的程序。要运行后台中的 nohup 命令，添加 & （ 表示"and"的符号）到命令的尾部。

无论是否将 nohup 命令的输出重定向到终端，输出都将附加到当前目录的 nohup.out 文件中。如果当前目录的 nohup.out 文件不可写，输出重定向到 $HOME/nohup.out 文件中。如果没有文件能创建或打开以用于追加，那么 Command 参数指定的命令不可调用。如果标准错误是一个终端，那么把指定的命令写给标准错误的所有输出作为标准输出重定向到相同的文件描述符。

```> nohup command > myout.file 2>&1 &```

在上面的例子中，输出被重定向到myout.file文件中。
nohup后台运行Unix/Linux下一般想让某个程序在后台运行，很多都是使用 & 在程序结尾来让程序自动运行。比如我们要运行mysql在后台：

```> /usr/local/mysql/bin/mysqld_safe –user=mysql &```

但是我们很多程序并不象mysqld一样可以做成守护进程，可能我们的程序只是普通程序而已，一般这种程序即使使用 & 结尾，如果终端关闭，那么程序也会被关闭。

为了能够后台运行，我们需要使用nohup这个命令，比如我们有个start.sh需要在后台运行，并且希望在后台能够一直运行，那么就使用nohup：

```> nohup /root/start.sh &```

在shell中回车后提示：

```> [~]$ appending output to nohup.out```

原程序的的标准输出被自动改向到当前目录下的nohup.out文件，起到了log的作用。

----
@tsingchan